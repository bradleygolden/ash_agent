# AshAgent Overview

AshAgent is an extension for the Ash Framework that brings AI agent capabilities into your Elixir applications through a declarative DSL.

## What is AshAgent?

AshAgent allows you to:

- Define AI agents as Ash resources
- Configure agent behavior using a declarative DSL
- Integrate LLM capabilities seamlessly with your Ash application
- Leverage Ash's powerful features (actions, policies, pubsub, etc.) for agent operations

## Architecture

AshAgent is built on top of two foundational libraries:

- **Ash** - Provides the declarative resource and domain framework
- **Spark** - Powers the DSL extension system

### Extension Points

AshAgent provides two main extensions:

#### 1. Resource Extension (`AshAgent.Resource`)

This extension adds agent-specific configuration to individual Ash resources.

```elixir
defmodule MyApp.MyAgent do
  use Ash.Resource,
    domain: MyApp.Domain,
    extensions: [AshAgent.Resource]

  agent do
    client "anthropic:claude-3-5-sonnet"

    output MyApp.Reply

    prompt "You are a helpful assistant."
  end
end
```

#### 2. Domain Extension (`AshAgent.Domain`)

This extension provides domain-level configuration that applies to all agent resources in the domain.

```elixir
defmodule MyApp.Domain do
  use Ash.Domain,
    extensions: [AshAgent.Domain]
end
```

## Key Concepts

### Declarative Configuration

AshAgent follows Ash's declarative philosophy. Instead of imperative code, you describe what your agents should do using a DSL.

### Provider Abstraction

Each agent chooses a provider via the `provider` option in the `agent` block. The default (`:req_llm`) requires a prompt and talks directly to ReqLLM. Providers declare their capabilities (e.g., `:tool_calling`, `:prompt_optional`) so the DSL can validate which features are available. For example:

```elixir
agent do
  provider :req_llm
  client "anthropic:claude-3-5-sonnet", temperature: 0.5
  output MyApp.Reply
  prompt ~p"..."
end
```

ash_baml users can import `AshAgent.Baml` and leverage `baml_provider/3` to configure the provider, client, and BAML function in one shotâ€”with no prompt required because the provider advertises `:prompt_optional`:

```elixir
import AshAgent.Baml

agent do
  baml_provider :support, :ChatAgent
  output MyApp.BamlClients.Support.Types.ChatAgent
end
```

### Type Safety

All configuration is validated at compile time using Spark's schema system, catching errors early.

### Extensibility

AshAgent is designed to be extended. You can add custom transformers, verifiers, and DSL sections to suit your needs.

### Telemetry

Every provider interaction emits telemetry spans:

- `[:ash_agent, :call]` for synchronous requests
- `[:ash_agent, :stream]` for streaming sessions

Metadata includes the agent module, provider, client, success/error status, and token usage when reported by the provider. Attach handlers with `:telemetry.attach/4` to wire these events into logging or observability pipelines.

## Integration with Ash

AshAgent resources are full Ash resources, which means you get:

- **Actions** - Define create, read, update, and destroy actions for your agents
- **Policies** - Control who can access and modify agents
- **PubSub** - Subscribe to agent events
- **Aggregates & Calculations** - Compute derived data
- **Relationships** - Connect agents to other resources

## Use Cases

AshAgent is ideal for:

- Building chatbot applications
- Creating autonomous agents
- Implementing LLM-powered workflows
- Developing AI-assisted features
- Orchestrating multi-agent systems

## Next Steps

- [Getting Started Guide](../tutorials/getting-started.md)
- DSL Reference (auto-generated by Spark)
